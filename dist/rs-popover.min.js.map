{"version":3,"file":"rs-popover.min.js","sources":["module.js","rsPopover.js","attachment.js","rsPopoverForm.js","popoverController.js","popoverState.js","registry.js","rsPopoverTrigger.js","tether.js"],"names":[],"mappings":"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","sourcesContent":["angular.module('rs.popover', []).run(function () {\n  'use strict';\n\n  var styleContent, styleTag;\n\n  styleContent = document.createTextNode('.rs-popover-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0 } \\\n    .rs-popover-loading, .rs-popover-error { width: 200px; height: 140px } \\\n    .rs-popover-error { color: #c40022 } \\\n    .rs-popover-message { width: 100%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; } \\\n    .rs-popover-body { margin: 0; padding: 20px }');\n  styleTag = document.createElement('style');\n  styleTag.type = 'text/css';\n  styleTag.appendChild(styleContent);\n\n  document.head.appendChild(styleTag);\n});\n","angular.module('rs.popover').directive('rsPopover', function () {\n  'use strict';\n\n  return {\n    scope: {\n      id: '@',\n      onOpen: '='\n    },\n    restrict: 'EA',\n    controller: 'PopoverController',\n    transclude: true,\n    templateUrl: 'rsPopover.html'\n  };\n});\n","angular.module('rs.popover').factory('Attachment', function () {\n  'use strict';\n\n  var VERTICAL_OFFSET = 11;\n  var HORIZONTAL_OFFSET = -33;\n\n  function Attachment(element, target) {\n    this.element = element;\n    this.target = target;\n  }\n\n  Attachment.prototype.position = function () {\n    var position, popoverElement;\n\n    position = this.target.offset();\n    position.top += this.target.outerHeight() + VERTICAL_OFFSET;\n    position.left += this.target.outerWidth() / 2 + HORIZONTAL_OFFSET;\n\n    popoverElement = $('.rs-popover', this.element).first();\n    popoverElement.css({ top: position.top, left: position.left });\n  };\n\n  return Attachment;\n});\n","angular.module('rs.popover').directive('rsPopoverForm', function () {\n  'use strict';\n\n  return {\n    scope: {\n      id: '@',\n      saveLabel: '@',\n      cancelLabel: '@',\n      onOpen: '=',\n      onSave: '='\n    },\n    restrict: 'EA',\n    controller: 'PopoverController',\n    transclude: true,\n    templateUrl: 'rsPopoverForm.html'\n  };\n});\n","angular.module('rs.popover').controller('PopoverController', function ($scope, $element, registry, tether, PopoverState) {\n  'use strict';\n\n  function resetState() {\n    var state;\n\n    state = new PopoverState();\n    state.on('open', $scope.onOpen || angular.noop);\n    state.on('save', $scope.onSave || angular.noop);\n    state.on('close', resetState);\n\n    $scope.state = state;\n  }\n\n  this.id = $scope.id;\n  registry.register($scope.id, $scope);\n  resetState();\n\n  $scope.$on('$destroy', function () {\n    registry.deregister($scope.id);\n  });\n\n  $scope.is = function (state) {\n    return $scope.state.is(state);\n  };\n\n  $scope.open = function (target) {\n    $scope.state.open();\n    tether.attach($element, target);\n  };\n\n  $scope.close = function () {\n    $scope.state.close();\n  };\n\n  $scope.toggle = function (target) {\n    if ($scope.state.is('closed')) {\n      $scope.open(target);\n    } else {\n      $scope.close();\n    }\n  };\n\n  $scope.save = function () {\n    $scope.state.save();\n  };\n});\n\n","angular.module('rs.popover').factory('PopoverState', function ($q) {\n  'use strict';\n\n  function PopoverState() {\n    this.state = PopoverState.CLOSED;\n    this.subscriptions = { open: [], load: [], error: [], save: [], close: [] };\n  }\n\n  PopoverState.prototype.is = function (state) {\n    return this.state === state;\n  };\n\n  PopoverState.prototype.on = function (e, handler) {\n    this.subscriptions[e].push(handler);\n  };\n\n  PopoverState.prototype.fire = function (e) {\n    var promises = [];\n\n    angular.forEach(this.subscriptions[e], function (handler) {\n      promises.push(handler());\n    });\n\n    return $q.all(promises);\n  };\n\n  PopoverState.prototype.open = function () {\n    this.message = 'Loadingâ€¦';\n    this.state = PopoverState.LOADING;\n    this.fire('open')\n      .then(angular.bind(this, this.load))\n      .catch(angular.bind(this, this.error));\n  };\n\n  PopoverState.prototype.load = function () {\n    this.state = PopoverState.OPEN;\n    this.fire('load');\n  };\n\n  PopoverState.prototype.error = function (message) {\n    this.message = message;\n    this.state = PopoverState.ERROR;\n    this.fire('error');\n  };\n\n  PopoverState.prototype.save = function () {\n    this.state = PopoverState.SAVING;\n    this.fire('save')\n      .then(angular.bind(this, this.close))\n      .catch(angular.bind(this, this.load));\n  };\n\n  PopoverState.prototype.close = function () {\n    this.state = PopoverState.CLOSED;\n    this.fire('close');\n  };\n\n  PopoverState.CLOSED = 'closed';\n  PopoverState.LOADING = 'loading';\n  PopoverState.OPEN = 'open';\n  PopoverState.ERROR = 'error';\n  PopoverState.SAVING = 'saving';\n\n  return PopoverState;\n});\n","angular.module('rs.popover').factory('registry', function () {\n  'use strict';\n\n  function Registry() {\n    this.popovers = {};\n  }\n\n  Registry.prototype.register = function (id, scope) {\n    if (!id) {\n      throw 'Popover ID must not be empty!';\n    } else if (id in this.popovers) {\n      throw 'Popover ID \"' + id + '\" has already been registered!';\n    }\n\n    this.popovers[id] = scope;\n  };\n\n  Registry.prototype.deregister = function (id) {\n    if (id in this.popovers) {\n      delete this.popovers[id];\n    } else {\n      throw 'Popover ID \"' + id + '\" has not been registered!';\n    }\n  };\n\n  Registry.prototype.popover = function (id) {\n    if (id in this.popovers) {\n      return this.popovers[id];\n    }\n\n    throw 'Popover ID \"' + id + '\" has not been registered!';\n  };\n\n  return new Registry();\n});\n","angular.module('rs.popover').directive('rsPopoverTrigger', function (registry) {\n  'use strict';\n\n  return {\n    restrict: 'A',\n    require: '?^rsPopover',\n    link: function (scope, element, attrs, popoverController) {\n      var id;\n\n      if (attrs.rsPopoverTrigger) {\n        id = attrs.rsPopoverTrigger;\n      } else if (popoverController) {\n        id = popoverController.id;\n      } else {\n        throw 'No popover ID was specified for popover trigger!';\n      }\n\n      element.on('click', function (e) {\n        e.preventDefault();\n\n        registry.popover(id).toggle(element);\n        scope.$apply();\n      });\n    }\n  };\n});\n\n","angular.module('rs.popover').factory('tether', function ($window, Attachment) {\n  'use strict';\n\n  function Tether() {\n    this.attachments = [];\n\n    angular.element($window).on('resize scroll', angular.bind(this, this.reposition));\n  }\n\n  Tether.prototype.attach = function (element, target) {\n    var attachment;\n\n    attachment = new Attachment(element, target);\n    attachment.position();\n\n    this.attachments.push(attachment);\n\n    return attachment;\n  };\n\n  Tether.prototype.reposition = function () {\n    angular.forEach(this.attachments, function (attachment) {\n      attachment.position();\n    });\n  };\n\n  Tether.prototype.detach = function (element) {\n    var index;\n\n    angular.forEach(this.attachments, function (attachment, i) {\n      if (attachment.element === element) {\n        index = i;\n      }\n    });\n\n    this.attachments.splice(index, 1);\n  };\n\n  return new Tether();\n});\n"],"sourceRoot":"/source/"}